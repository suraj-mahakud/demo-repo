<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validate QR Code</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <style>
        body {
            background-color: #f2f2f2;
        }

        .box {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
        }
    </style>
</head>

<body>
    <div class="box">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 offset-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h3>Validate QR Code</h3>
                        </div>
                        <div class="card-body">
                            <form id="validateForm">
                                <div class="mb-3">
                                    <input type="text" id="role_number" placeholder="Enter Role Number" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <button type="submit" class="btn btn-primary">Validate</button>
                                </div>
                            </form>
                            <div id="result" style="display: none;" class="alert alert-info"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const secretKey = CryptoJS.enc.Hex.parse('e5b48b1d8b1e39b2f746a5b8a1d5c8f7e9b5a3d5e7b4c8e1d9f5a4b7c3e6b5a7'); // Key must be in hex format

        function decryptData(encryptedData, key) {
            // Split the encrypted data to extract the IV
            const parts = encryptedData.split('::');
            const iv = CryptoJS.enc.Base64.parse(parts[1]);
            const encrypted = parts[0];
            
            // Decrypt the data
            const decrypted = CryptoJS.AES.decrypt(encrypted, key, {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });
            return decrypted.toString(CryptoJS.enc.Utf8);
        }

        document.getElementById('validateForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const urlParams = new URLSearchParams(window.location.search);
            const encryptedData = urlParams.get('data');
            const inputRoleNumber = document.getElementById('role_number').value;

            if (!encryptedData) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').innerText = 'No data to decrypt.';
                return;
            }

            const decryptedData = decryptData(encryptedData, secretKey);

            const regex = /Role Number: (\d+)/;
            const match = decryptedData.match(regex);

            if (match && match[1] === inputRoleNumber) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').innerText = `Decrypted Data:\n${decryptedData}`;
            } else {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').innerText = 'Invalid Role Number. Access Denied.';
            }
        });
    </script>
</body>

</html>
